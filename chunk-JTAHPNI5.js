import{a as te}from"./chunk-DQIHD3SX.js";import{b as R,d as J,e as K,f as Q,g as X,h as Y,p as Z,s as $}from"./chunk-UMXV7FSD.js";import{a as E,c as L,f as ee}from"./chunk-E3PR7NZM.js";import{i as U,j as D,k as q,m as H,o as z}from"./chunk-KT27TMF4.js";import{$ as p,Ab as s,Bb as h,Cb as C,Da as a,Eb as x,Fb as b,Gb as v,Ja as F,M as I,Mb as N,Ob as j,Pa as O,Q as k,U as G,Ua as _,a as V,aa as u,b as P,d as M,db as c,eb as i,fb as n,gb as d,mb as A,o as w,qb as f,r as S,sb as g,z as B,za as y,zb as W}from"./chunk-IGH6FCT7.js";var T=class r{constructor(t){this.http=t}apiUrl=`${ee.apiUrl}/admin/blog`;getBlogs(){return console.log("AdminBlogService: Making request to:",this.apiUrl),console.log("AdminBlogService: With headers:",this.getAuthHeaders()),this.http.get(this.apiUrl,{headers:new E(this.getAuthHeaders())}).pipe(I(t=>{console.log("AdminBlogService: Response received:",t)}),S(t=>t.blogs?.data||t.data||t),B(t=>(console.error("AdminBlogService: Error occurred:",t),w(()=>t))))}addBlog(t){return console.log("AdminBlogService: Adding blog:",t),this.http.post(this.apiUrl,t,{headers:new E(this.getAuthHeaders())}).pipe(I(e=>{console.log("AdminBlogService: Add blog response:",e)}),S(e=>e.data||e),B(e=>(console.error("AdminBlogService: Add blog error:",e),w(()=>e))))}editBlog(t,e){return console.log("AdminBlogService: Editing blog:",t,e),this.http.patch(`${this.apiUrl}/${t}`,e,{headers:new E(this.getAuthHeaders())}).pipe(I(o=>{console.log("AdminBlogService: Edit blog response:",o)}),S(o=>o.data||o),B(o=>(console.error("AdminBlogService: Edit blog error:",o),w(()=>o))))}deleteBlog(t){return console.log("AdminBlogService: Deleting blog:",t),this.http.delete(`${this.apiUrl}/${t}`,{headers:new E(this.getAuthHeaders()),body:{reason:"Deleted by admin"}}).pipe(I(e=>{console.log("AdminBlogService: Delete blog response:",e)}),S(e=>e.data||e),B(e=>(console.error("AdminBlogService: Delete blog error:",e),w(()=>e))))}getAuthHeaders(){let t=localStorage.getItem("token");return t?{Authorization:`Access ${t}`}:{}}static \u0275fac=function(e){return new(e||r)(G(L))};static \u0275prov=k({token:r,factory:r.\u0275fac,providedIn:"root"})};function le(r,t){r&1&&(i(0,"div",11),d(1,"app-loading-spinner"),n())}function oe(r,t){if(r&1){let e=A();i(0,"div",12),d(1,"i",13),i(2,"p",14),s(3),n(),i(4,"button",15),f("click",function(){p(e);let l=g();return u(l.loadBlogs())}),d(5,"i",16),s(6," Retry "),n()()}if(r&2){let e=g();a(3),h(e.error)}}function ae(r,t){if(r&1&&d(0,"img",43),r&2){let e=g().$implicit;c("src",e.image.secure_url,y)}}function de(r,t){if(r&1&&d(0,"img",44),r&2){let e=t.$implicit;c("src",e.secure_url,y)}}function se(r,t){if(r&1){let e=A();i(0,"tr",31)(1,"td",32),s(2),n(),i(3,"td",33),s(4),n(),i(5,"td",33),s(6),n(),i(7,"td",33),s(8),n(),i(9,"td",33),_(10,ae,1,1,"img",34),n(),i(11,"td",33)(12,"div",35),_(13,de,1,1,"img",36),n()(),i(14,"td",37),s(15),N(16,"date"),n(),i(17,"td",38)(18,"button",39),f("click",function(){let l=p(e).$implicit,m=g(2);return u(m.editBlog(l))}),d(19,"i",40),n(),i(20,"button",41),f("click",function(){let l=p(e).$implicit,m=g(2);return u(m.deleteBlog(l))}),d(21,"i",42),n()()()}if(r&2){let e=t.$implicit;a(2),h(e.title_en),a(2),h(e.title_ar),a(2),h(e.subTitle_en),a(2),h(e.category),a(2),c("ngIf",e.image==null?null:e.image.secure_url),a(3),c("ngForOf",e.gallery),a(2),h(j(16,7,e.createdAt,"mediumDate"))}}function me(r,t){if(r&1&&(i(0,"div",17)(1,"table",18)(2,"thead")(3,"tr",19)(4,"th",20),d(5,"i",21),s(6," Title EN"),n(),i(7,"th",20),d(8,"i",21),s(9," Title AR"),n(),i(10,"th",20),d(11,"i",22),s(12," Subtitle EN"),n(),i(13,"th",20),d(14,"i",23),s(15," Category"),n(),i(16,"th",20),d(17,"i",24),s(18," Image"),n(),i(19,"th",20),d(20,"i",25),s(21," Gallery"),n(),i(22,"th",20),d(23,"i",26),s(24," Created At"),n(),i(25,"th",27),d(26,"i",28),s(27," Actions"),n()()(),i(28,"tbody",29),_(29,se,22,10,"tr",30),n()()()),r&2){let e=g();a(29),c("ngForOf",e.blogs)}}function ge(r,t){if(r&1&&(i(0,"div",81),d(1,"i",82),s(2),n()),r&2){let e=g(2);a(2),C(" ",e.success," ")}}function ce(r,t){if(r&1&&(i(0,"div",83),d(1,"i",84),s(2),n()),r&2){let e=g(2);a(2),C(" ",e.error," ")}}function pe(r,t){if(r&1&&(i(0,"div",85),d(1,"img",86),n()),r&2){let e=g(2);a(),c("src",e.form.image.secure_url,y)}}function ue(r,t){if(r&1&&(i(0,"div",85),d(1,"img",87),n()),r&2){let e=g(2);a(),c("src",e.getMainImagePreview(),y)}}function _e(r,t){if(r&1&&(i(0,"div",92),d(1,"img",93),i(2,"button",94),d(3,"i",95),n()()),r&2){let e=t.$implicit;a(),c("src",e.secure_url,y)}}function fe(r,t){if(r&1&&(i(0,"div",88)(1,"p",89),s(2,"Current Gallery (Read-only until API update):"),n(),i(3,"div",90),_(4,_e,4,1,"div",91),n()()),r&2){let e=g(2);a(4),c("ngForOf",e.form.gallery)}}function xe(r,t){if(r&1){let e=A();i(0,"div",92),d(1,"img",96),i(2,"button",97),f("click",function(){let l=p(e).index,m=g(3);return u(m.removeNewGalleryImage(l))}),d(3,"i",98),n()()}if(r&2){let e=t.$implicit,o=g(3);a(),c("src",o.getImagePreviewSync(e),y)}}function be(r,t){if(r&1&&(i(0,"div",88)(1,"p",89),s(2,"New Images to Add:"),n(),i(3,"div",90),_(4,xe,4,1,"div",91),n()()),r&2){let e=g(2);a(4),c("ngForOf",e.form.newGalleryImages)}}function ve(r,t){if(r&1){let e=A();i(0,"div",45)(1,"div",46)(2,"h3",47),d(3,"i",48),s(4),n(),_(5,ge,3,1,"div",49)(6,ce,3,1,"div",50),i(7,"form",51),f("ngSubmit",function(){p(e);let l=g();return u(l.saveBlog())}),i(8,"input",52),v("ngModelChange",function(l){p(e);let m=g();return b(m.form.title_en,l)||(m.form.title_en=l),u(l)}),n(),i(9,"input",53),v("ngModelChange",function(l){p(e);let m=g();return b(m.form.subTitle_en,l)||(m.form.subTitle_en=l),u(l)}),n(),i(10,"textarea",54),v("ngModelChange",function(l){p(e);let m=g();return b(m.form.content_en,l)||(m.form.content_en=l),u(l)}),n(),i(11,"input",55),v("ngModelChange",function(l){p(e);let m=g();return b(m.form.category,l)||(m.form.category=l),u(l)}),n(),i(12,"input",56),v("ngModelChange",function(l){p(e);let m=g();return b(m.form.title_ar,l)||(m.form.title_ar=l),u(l)}),n(),i(13,"input",57),v("ngModelChange",function(l){p(e);let m=g();return b(m.form.subTitle_ar,l)||(m.form.subTitle_ar=l),u(l)}),n(),i(14,"textarea",58),v("ngModelChange",function(l){p(e);let m=g();return b(m.form.content_ar,l)||(m.form.content_ar=l),u(l)}),n(),i(15,"div",59)(16,"h4",60),d(17,"i",61),s(18," Image Management "),i(19,"span",62),s(20,"API Update Required"),n()(),i(21,"div",63),d(22,"i",64),i(23,"strong"),s(24,"Note:"),n(),s(25," Image updates require a separate API endpoint. Please update images through the dedicated image management system. "),n(),i(26,"div",65)(27,"label",66),s(28,"Main Image:"),n(),i(29,"div",67)(30,"div",68),_(31,pe,2,1,"div",69)(32,ue,2,1,"div",69),n(),i(33,"div",70)(34,"input",71),f("change",function(l){p(e);let m=g();return u(m.onMainImageChange(l))}),n()()()(),i(35,"div")(36,"label",66),s(37,"Gallery Images:"),n(),_(38,fe,5,1,"div",72)(39,be,5,1,"div",72),i(40,"div",73)(41,"input",74),f("change",function(l){p(e);let m=g();return u(m.addGalleryImage(l))}),n(),i(42,"button",75),d(43,"i",6),n()()()(),i(44,"div",76)(45,"button",77),f("click",function(){p(e);let l=g();return u(l.closeModal())}),d(46,"i",78),s(47," Cancel "),n(),i(48,"button",79),d(49,"i",80),s(50),n()()()()()}if(r&2){let e=g();a(3),c("ngClass",e.editMode?"fa-edit":"fa-plus-circle"),a(),C(" ",e.editMode?"Edit":"Add"," Blog "),a(),c("ngIf",e.success),a(),c("ngIf",e.error),a(2),x("ngModel",e.form.title_en),a(),x("ngModel",e.form.subTitle_en),a(),x("ngModel",e.form.content_en),a(),x("ngModel",e.form.category),a(),x("ngModel",e.form.title_ar),a(),x("ngModel",e.form.subTitle_ar),a(),x("ngModel",e.form.content_ar),a(17),c("ngIf",e.form.image==null?null:e.form.image.secure_url),a(),c("ngIf",e.form.newImage&&e.getMainImagePreview()),a(6),c("ngIf",e.form.gallery.length>0),a(),c("ngIf",e.form.newGalleryImages.length>0),a(9),c("disabled",e.saving),a(),W(e.saving?"fa-spinner fa-spin":"fa-save"),a(),C(" ",e.saving?"Saving...":"Save"," ")}}var ie=class r{constructor(t){this.adminBlogService=t}blogs=[];loading=!1;saving=!1;error=null;success=null;imagePreviews={};ngOnInit(){this.loadBlogs()}loadBlogs(){this.loading=!0,this.error=null,console.log("AdminBlog: Starting to load blogs..."),this.adminBlogService.getBlogs().subscribe({next:t=>{console.log("AdminBlog: Success response:",t),this.blogs=t.blogs?.data||t.data||t,this.loading=!1,console.log("AdminBlog: Blogs loaded:",this.blogs)},error:t=>{console.error("AdminBlog: Error details:",t),this.error=t.message||"Failed to load blogs",this.loading=!1,console.log("AdminBlog: Error message:",this.error)}})}isModalOpen=!1;editMode=!1;form={title_en:"",subTitle_en:"",content_en:"",category:"",title_ar:"",subTitle_ar:"",content_ar:"",image:null,gallery:[],newImage:null,newGalleryImages:[],removedGalleryImages:[]};editingIndex=null;openAddBlogModal(){this.editMode=!1,this.form={title_en:"",subTitle_en:"",content_en:"",category:"",title_ar:"",subTitle_ar:"",content_ar:"",image:null,gallery:[],newImage:null,newGalleryImages:[],removedGalleryImages:[]},this.isModalOpen=!0}editBlog(t){this.editMode=!0,this.form=P(V({},t),{newImage:null,newGalleryImages:[],removedGalleryImages:[]}),this.editingIndex=this.blogs.indexOf(t),this.isModalOpen=!0}saveBlog(){if(!this.form.title_en||!this.form.title_ar){this.error="Title in both English and Arabic is required";return}this.saving=!0,this.error=null,this.success=null;let t=["title_en","title_ar","subTitle_en","subTitle_ar","content_en","content_ar","category","image","gallery"],e={};t.forEach(o=>{this.form[o]!==void 0&&this.form[o]!==null&&(e[o]=this.form[o])}),this.editMode&&this.editingIndex!==null?this.adminBlogService.editBlog(this.form._id,e).subscribe({next:()=>{this.success="Blog updated successfully!",this.loadBlogs(),setTimeout(()=>{this.closeModal(),this.success=null},1500),this.saving=!1},error:o=>{this.error=o.message||"Failed to update blog",this.saving=!1}}):this.adminBlogService.addBlog(e).subscribe({next:()=>{this.success="Blog added successfully!",this.loadBlogs(),setTimeout(()=>{this.closeModal(),this.success=null},1500),this.saving=!1},error:o=>{this.error=o.message||"Failed to add blog",this.saving=!1}})}deleteBlog(t){confirm("Are you sure you want to delete this blog?")&&this.adminBlogService.deleteBlog(t._id).subscribe({next:()=>{this.loadBlogs()},error:e=>{this.error=e.message}})}onMainImageChange(t){return M(this,null,function*(){this.error="Main image updates require API update. This feature will be available soon.",t.target.value="",setTimeout(()=>{this.error=null},3e3)})}addGalleryImage(t){return M(this,null,function*(){this.error="Gallery image uploads require API update. This feature will be available soon.",t.target.value="",setTimeout(()=>{this.error=null},3e3)})}removeGalleryImage(t){this.error="Gallery image removal requires API update. This feature will be available soon.",setTimeout(()=>{this.error=null},3e3)}removeNewGalleryImage(t){let e=this.form.newGalleryImages[t];e&&e.name&&delete this.imagePreviews[e.name],this.form.newGalleryImages.splice(t,1)}getImagePreviewSync(t){return this.imagePreviews[t.name]||""}getMainImagePreview(){return this.imagePreviews["main_"+(this.form.newImage?.name||"")]||""}getImagePreview(t){return M(this,null,function*(){return new Promise(e=>{let o=new FileReader;o.onload=l=>e(l.target?.result),o.onerror=()=>e(""),o.readAsDataURL(t)})})}triggerFileInput(){console.log("Image upload disabled - requires separate API endpoint")}closeModal(){this.isModalOpen=!1,this.error=null,this.success=null,this.imagePreviews={}}static \u0275fac=function(e){return new(e||r)(F(T))};static \u0275cmp=O({type:r,selectors:[["app-admin-blog"]],decls:13,vars:4,consts:[[1,"p-6","bg-[#041f1e]","text-white","min-h-screen","arabic-font"],[1,"max-w-6xl","mx-auto","bg-[#1e4d4e]","rounded-2xl","shadow-2xl","p-8","border","border-[var(--icon-color)]"],[1,"flex","justify-between","items-center","mb-8","border-b","border-gray-700","pb-4"],[1,"text-3xl","font-bold","flex","items-center","gap-2"],[1,"fas","fa-blog","text-[var(--icon-color)]"],[1,"flex","items-center","gap-2","bg-[var(--icon-color)]","hover:bg-[#449397]","px-5","py-2","rounded-lg","font-medium","text-white","shadow-md","transition-all",3,"click"],[1,"fas","fa-plus"],["class","text-center py-10 text-gray-400 text-lg",4,"ngIf"],["class","text-center py-10 text-red-400",4,"ngIf"],["class","overflow-x-auto rounded-lg shadow-inner mt-6",4,"ngIf"],["class","fixed inset-0 bg-black/60 flex items-center justify-center z-50 modal-overlay",4,"ngIf"],[1,"text-center","py-10","text-gray-400","text-lg"],[1,"text-center","py-10","text-red-400"],[1,"fas","fa-exclamation-triangle","text-2xl","mb-3"],[1,"text-lg","mb-4"],[1,"bg-[var(--icon-color)]","hover:bg-[#449397]","px-5","py-2","rounded-lg","font-medium","text-white","transition-all",3,"click"],[1,"fas","fa-redo"],[1,"overflow-x-auto","rounded-lg","shadow-inner","mt-6"],[1,"min-w-full","text-sm","border","border-gray-700"],[1,"bg-[#154142]","text-gray-200"],[1,"py-3","px-4","text-left"],[1,"fas","fa-heading","mr-1"],[1,"fas","fa-subscript","mr-1"],[1,"fas","fa-tags","mr-1"],[1,"fas","fa-image","mr-1"],[1,"fas","fa-images","mr-1"],[1,"fas","fa-calendar-alt","mr-1"],[1,"py-3","px-4","text-center"],[1,"fas","fa-tools"],[1,"divide-y","divide-gray-700"],["class","table-row hover:bg-[#173b3c]",4,"ngFor","ngForOf"],[1,"table-row","hover:bg-[#173b3c]"],[1,"py-3","px-4","font-semibold"],[1,"py-3","px-4"],["alt","Blog Image","class","w-16 h-16 object-cover rounded border border-gray-600 shadow-sm",3,"src",4,"ngIf"],[1,"flex","space-x-1"],["alt","Gallery Image","class","w-8 h-8 object-cover rounded border border-gray-600",3,"src",4,"ngFor","ngForOf"],[1,"py-3","px-4","text-xs","text-gray-400"],[1,"py-3","px-4","text-center","space-x-3"],["title","Edit",1,"text-blue-400","hover:text-blue-300","btn-edit",3,"click"],[1,"fas","fa-edit","text-lg"],["title","Delete",1,"text-red-500","hover:text-red-400","btn-delete",3,"click"],[1,"fas","fa-trash-alt","text-lg"],["alt","Blog Image",1,"w-16","h-16","object-cover","rounded","border","border-gray-600","shadow-sm",3,"src"],["alt","Gallery Image",1,"w-8","h-8","object-cover","rounded","border","border-gray-600",3,"src"],[1,"fixed","inset-0","bg-black/60","flex","items-center","justify-center","z-50","modal-overlay"],[1,"bg-[#1e4d4e]","p-6","rounded-2xl","shadow-2xl","w-full","max-w-lg","border","border-[var(--icon-color)]","max-h-[90vh]","overflow-y-auto","modal-content"],[1,"text-xl","font-semibold","mb-6","flex","items-center","gap-2"],[1,"fas",3,"ngClass"],["class","bg-green-600/20 border border-green-500 text-green-400 px-4 py-3 rounded-lg text-center",4,"ngIf"],["class","bg-red-600/20 border border-red-500 text-red-400 px-4 py-3 rounded-lg text-center",4,"ngIf"],[1,"space-y-5",3,"ngSubmit"],["type","text","name","title_en","placeholder","Title (English)","required","",1,"w-full","px-4","py-2","rounded","bg-[#173b3c]","border","border-gray-600","text-white","placeholder-gray-400","form-input",3,"ngModelChange","ngModel"],["type","text","name","subTitle_en","placeholder","Subtitle (English)",1,"w-full","px-4","py-2","rounded","bg-[#173b3c]","border","border-gray-600","text-white","placeholder-gray-400","form-input",3,"ngModelChange","ngModel"],["name","content_en","placeholder","Content (English)","rows","4",1,"w-full","px-4","py-2","rounded","bg-[#173b3c]","border","border-gray-600","text-white","placeholder-gray-400","form-input",3,"ngModelChange","ngModel"],["type","text","name","category","placeholder","Category",1,"w-full","px-4","py-2","rounded","bg-[#173b3c]","border","border-gray-600","text-white","placeholder-gray-400","form-input",3,"ngModelChange","ngModel"],["type","text","name","title_ar","placeholder","Title (Arabic)",1,"w-full","px-4","py-2","rounded","bg-[#173b3c]","border","border-gray-600","text-white","placeholder-gray-400","form-input",3,"ngModelChange","ngModel"],["type","text","name","subTitle_ar","placeholder","Subtitle (Arabic)",1,"w-full","px-4","py-2","rounded","bg-[#173b3c]","border","border-gray-600","text-white","placeholder-gray-400","form-input",3,"ngModelChange","ngModel"],["name","content_ar","placeholder","Content (Arabic)","rows","4",1,"w-full","px-4","py-2","rounded","bg-[#173b3c]","border","border-gray-600","text-white","placeholder-gray-400","form-input",3,"ngModelChange","ngModel"],[1,"border-t","border-gray-600","pt-4","mt-6","image-upload-section"],[1,"text-lg","font-medium","mb-4","flex","items-center","gap-2"],[1,"fas","fa-images","text-[var(--icon-color)]"],[1,"text-xs","bg-yellow-600","text-white","px-2","py-1","rounded"],[1,"bg-yellow-600/20","border","border-yellow-500","text-yellow-400","px-4","py-3","rounded-lg","mb-4"],[1,"fas","fa-info-circle","mr-2"],[1,"mb-6"],[1,"block","text-sm","font-medium","mb-2"],[1,"flex","items-center","gap-4"],[1,"flex","gap-2"],["class","image-preview-container",4,"ngIf"],[1,"flex-1"],["type","file","accept","image/*","disabled","","title","Image updates require separate API endpoint",1,"file-input",3,"change"],["class","mb-4",4,"ngIf"],[1,"flex","items-center","gap-2"],["type","file","accept","image/*","multiple","","disabled","",1,"flex-1","file-input",3,"change"],["type","button","disabled","",1,"px-3","py-2","bg-gray-600","text-white","rounded","text-sm","transition-all","cursor-not-allowed"],[1,"flex","justify-end","space-x-3","pt-4"],["type","button",1,"px-5","py-2","rounded","bg-gray-600","hover:bg-gray-500","text-white","transition-all",3,"click"],[1,"fas","fa-times","mr-1"],["type","submit",1,"px-5","py-2","rounded","bg-[var(--icon-color)]","hover:bg-[#449397]","text-white","font-medium","transition-all","disabled:opacity-50","disabled:cursor-not-allowed",3,"disabled"],[1,"fas","fa-save","mr-1"],[1,"bg-green-600/20","border","border-green-500","text-green-400","px-4","py-3","rounded-lg","text-center"],[1,"fas","fa-check-circle","mr-2"],[1,"bg-red-600/20","border","border-red-500","text-red-400","px-4","py-3","rounded-lg","text-center"],[1,"fas","fa-exclamation-triangle","mr-2"],[1,"image-preview-container"],["alt","Current Main Image",1,"w-20","h-20","object-cover","rounded","border","border-gray-600","image-preview",3,"src"],["alt","New Main Image",1,"w-20","h-20","object-cover","rounded","border","border-gray-600","image-preview","border-green-500",3,"src"],[1,"mb-4"],[1,"text-xs","text-gray-400","mb-2"],[1,"gallery-grid"],["class","gallery-item",4,"ngFor","ngForOf"],[1,"gallery-item"],["alt","Gallery Image",1,"w-full","h-16","object-cover","image-preview",3,"src"],["type","button","disabled","","title","Gallery management requires API update",1,"remove-image-btn","bg-gray-600","cursor-not-allowed"],[1,"fas","fa-lock","text-xs"],["alt","New Gallery Image","onerror","this.src='https://via.placeholder.com/150?text=Preview+Error'",1,"w-full","h-16","object-cover","image-preview",3,"src"],["type","button",1,"remove-image-btn",3,"click"],[1,"fas","fa-times","text-xs"]],template:function(e,o){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),d(4,"i",4),s(5," Blog Management "),n(),i(6,"button",5),f("click",function(){return o.openAddBlogModal()}),d(7,"i",6),s(8," Add Blog "),n()(),_(9,le,2,0,"div",7)(10,oe,7,1,"div",8)(11,me,30,1,"div",9),n(),_(12,ve,51,19,"div",10),n()),e&2&&(a(9),c("ngIf",o.loading),a(),c("ngIf",o.error),a(),c("ngIf",!o.loading&&!o.error),a(),c("ngIf",o.isModalOpen))},dependencies:[z,U,D,q,$,Y,R,J,K,Z,X,Q,te,H],encapsulation:2})};export{ie as AdminBlog};
